"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class VDom{constructor(e,t={},r=[]){this.tag=e,this.props=Object.assign({},t,{children:r})}clone(e=this.tag,t=this.props,r=this.props.children){return new VDom(e,t,r)}emit(e,...t){this.prevent||("remove"===e&&(this.prevent=!0),"function"==typeof this.props[e]&&this.props[e](...t))}}function h(e,t,...r){return new VDom(e||"",t,concat(r))}function isVDom(e){return"object"==typeof e&&e instanceof VDom}function concat(e,t=[]){for(let r=0;r<e.length;r++){let o=e[r];Array.isArray(o)?concat(o,t):t.push(isVDom(o)?o:new VDom("",{},[o||""]))}return t}function create(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):e?document.createElement(e):document.createTextNode("")}function root(e){return e.shadowRoot||e}function remove(e,t){root(e).removeChild(t)}function append(e,t){root(e).appendChild(t)}function replace(e,t,r){root(e).replaceChild(t,r)}let FPS=1e3/120,MASTER="__master__",REMOVE="__remove__",LISTENER="__listeners__",IGNORE=["children","create","created","remove","removed","update","updated","context","state","static"];function render(e,t,r,o,n){return diff(t,r,e,o,n)}function getMaster(e){return e&&e[MASTER]||{}}function defer(e){setTimeout(e,FPS)}function createComponent(e,t,r,o,n,i){let s;return{tag:e,render:function c(p,f,a,l){let d=!0;return f=diff(p,f,e(a,{set:e=>{t=e,f[REMOVE]||s||d||(s=!0,defer(()=>{c(p,f,a,l),s=!1}))},get:()=>t},l),l,r,o,n+1,i),d=!1,f},get prevent(){return s}}}function diff(e,t,r,o={},n,i=0,s=0,c={}){r=isVDom(r)?r:new VDom("",{},[r||""]);let p,f,a=t,{prev:l=new VDom,components:d=c}=getMaster(a),u=r.props.context;if(o=u?Object.assign({},o,u):o,n="svg"===r.tag||n,l===r||l.tag&&r.tag&&r.props.static)return a;d[s]&&d[s].tag!==r.tag&&delete d[s],"function"==typeof r.tag&&((d[s]||{}).tag!==r.tag&&(d[s]=createComponent(r.tag,r.props.state,n,i,s,d)),p=d[s],r=r.clone(l.tag||(n?"g":"")));let m=r.props.children;if(r.tag!==l.tag){if(a=create(r.tag,n),t){if(!p&&""!==r.tag){let e=m.length;for(;t.firstChild&&e--;)append(a,t.firstChild)}replace(e,a,t),emitRemove(t)}else append(e,a);f=!0,r.emit("create",a)}if(p)return i&&p.prevent?a:p.render(e,a,r.props,o);if(r.tag){if(f||!1!==r.emit("update",a,l.props,r.props)){diffProps(a,r.tag===l.tag?l.props:{},r.props,n),i++;let e=Array.from(root(a).childNodes),t=Math.max(e.length,m.length);for(let r=0;r<t;r++)m[r]?diff(a,e[r],m[r],o,n,i):e[r]&&(emitRemove(e[r]),remove(a,e[r]))}}else l.props.children[0]!==r.props.children[0]&&(a.textContent=String(r.props.children[0]));return a[MASTER]={prev:r,components:d},r.emit(f?"created":"updated",a),a}function diffProps(e,t,r,o){let n=Object.keys(t),i=Object.keys(r).filter(e=>-1===n.indexOf(e)),s=n.concat(i);for(let n=0;n<s.length;n++){let i=s[n];if(IGNORE.indexOf(i)>-1||t[i]===r[i])continue;let c="function"==typeof t[i],p="function"==typeof r[i];if(c||p)!p&&c&&e.removeEventListener(i,e[LISTENER][i][0]),p&&(c||(e[LISTENER]=e[LISTENER]||{},e[LISTENER][i]||(e[LISTENER][i]=[t=>{e[LISTENER][i][1](t)}]),e.addEventListener(i,e[LISTENER][i][0])),e[LISTENER][i][1]=r[i]);else if(i in r)if(i in e&&!o||o&&"style"===i)if("style"===i)if("object"==typeof r[i]){let o=t[i]||{},n=r[i];for(let t in n)o[t]!==n[t]&&("-"===t[0]?e.setProperty(t,n[t]):e.style[t]=n[t])}else e.style.cssText=r[i];else e[i]=r[i];else o?e.setAttributeNS(null,i,r[i]):e.setAttribute(i,r[i]);else e.removeAttribute(i)}}function emitRemove(e){let{prev:t=new VDom}=getMaster(e),r=e.childNodes;e[REMOVE]=!0,t.emit("remove",e);for(let e=0;e<r.length;e++)emitRemove(r[e]);t.emit("removed",e)}exports.render=render,exports.h=h,exports.isVDom=isVDom;
//# sourceMappingURL=orby.js.map
